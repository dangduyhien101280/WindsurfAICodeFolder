<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    {{ ui_style | safe }}
    <title>Vocabulary Flashcards</title>
</head>
<body>
    <div class="container main-content">
        <header>
            <h1>Vocabulary Flashcards</h1>
            <div class="user-section">
                <button class="btn btn-user-login" id="userLoginBtn">
                    <i class="fas fa-user"></i>Learning Dashboard
                </button>
                <button class="btn btn-profile" id="userProfileBtn">
                    <i class="fas fa-user-circle"></i>Profile
                </button>
                <input type="file" id="avatarUpload" accept="image/*" style="display:none;" />
                <button class="btn btn-save-avatar" id="saveAvatarBtn" style="display:none;">Save Avatar</button>
            </div>
            <p class="progress-text">
                Progress: <span id="learned">0</span> / <span id="total">0</span> words learned
            </p>
            <p class="study-date" id="studyDate">Next Review: Not scheduled</p>
                        
            <!-- Settings Section -->
            <div class="settings">
                <div class="setting-item">
                    <label for="autoSpeak">Auto-speak:</label>
                    <input type="checkbox" id="autoSpeak">
                </div>
                <div class="setting-item">
                    <label for="speechRate">Speech rate:</label>
                    <input type="range" id="speechRate" min="0.5" max="2.0" step="0.1" value="1.0">
                    <span id="rateValue">1.0x</span>
                </div>

            </div>
        </header>

        <!-- Box System -->
        <div class="box-system">
            <h2 class="box-system-title">Learning Progress</h2>
            <div class="box-container">
                <div class="box" data-box="0">
                    <div class="box-left">
                        <span class="box-label">New</span>
                        <span class="box-interval">Now</span>
                    </div>
                    <span class="box-count">0</span>
                </div>
                <div class="box" data-box="1">
                    <div class="box-left">
                        <span class="box-label">Box 1</span>
                        <span class="box-interval">1 day</span>
                    </div>
                    <span class="box-count">0</span>
                </div>
                <div class="box" data-box="2">
                    <div class="box-left">
                        <span class="box-label">Box 2</span>
                        <span class="box-interval">3 days</span>
                    </div>
                    <span class="box-count">0</span>
                </div>
                <div class="box" data-box="3">
                    <div class="box-left">
                        <span class="box-label">Box 3</span>
                        <span class="box-interval">10 days</span>
                    </div>
                    <span class="box-count">0</span>
                </div>
                <div class="box" data-box="4">
                    <div class="box-left">
                        <span class="box-label">Box 4</span>
                        <span class="box-interval">30 days</span>
                    </div>
                    <span class="box-count">0</span>
                </div>
                <div class="box" data-box="5">
                    <div class="box-left">
                        <span class="box-label">Learned</span>
                        <span class="box-interval">90 days</span>
                    </div>
                    <span class="box-count">0</span>
                </div>
            </div>
        </div>

        <!-- Flashcard -->
        <div class="flashcard" id="flashcard">
            <div class="card-inner">
                <span id="card-number" class="card-number card-number-front">0/0</span>
                <span id="box-number" class="box-number box-number-front">Box: 0</span>
                <div class="card-front">
                    <div class="card-header">
                        <span id="pos" class="pos-tag">POS</span>
                        <span id="ipa" class="ipa-text"></span>
                    </div>
                    <div class="word-section">
                        <h2 id="word">Welcome</h2>
                    </div>
                    <div class="card-actions">
                        <button class="btn-icon" id="speakBtn" title="Speak">üîä</button>
                        <button class="btn-icon" id="flipBtn" title="Flip">‚Üª</button>
                    </div>
                </div>
                <div class="card-back">
                    <span id="card-number-back" class="card-number card-number-back">0/0</span>
                    <span id="box-number-back" class="box-number box-number-back">Box: 0</span>
                    <p id="meaning"><strong>to greet someone in a polite or friendly way</strong></p>
                    <div class="back">
                        <span id="back-word" style="color: red;">{{ english_word }}</span>
                        <table>
                            <tr>
                                <th>Ti·∫øng Vi·ªát</th>
                                <th>Ti·∫øng Trung</th>
                                <th>Ti·∫øng Nh·∫≠t</th>
                            </tr>
                            <tr>
                                <td id="vietnamese-translation">{{ vietnamese_translation }}</td>
                                <td id="chinese-translation">{{ chinese if chinese else 'Kh√¥ng c√≥ b·∫£n d·ªãch' }}</td>
                                <td id="japanese-translation">{{ japanese if japanese else 'Kh√¥ng c√≥ b·∫£n d·ªãch' }}</td>
                            </tr>
                        </table>
                        <p id="example">They welcomed us with open arms.</p>
                    </div>
                    <div class="card-actions">
                        <button class="btn-icon" id="flipBackBtn" title="Flip">‚Üª</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <button class="btn btn-secondary" id="prevBtn">Previous</button>
            <button class="btn btn-primary" id="markLearnedBtn">I Know This</button>
            <button class="btn btn-secondary" id="markReviewBtn">Review Again</button>
            <button class="btn btn-secondary" id="nextBtn">Next</button>
        </div>

        <!-- Card Counter -->
        <p class="progress-text">
            Card <span id="currentCard">1</span> of <span id="totalCards">0</span>
        </p>

        <!-- YouTube Import -->
        <div class="import-container">           
            <button class="btn btn-secondary" id="exportdataBtn">Export Data</button>
            <button class="btn btn-secondary" id="importdataBtn">Import Data</button>
            <input type="file" id="import-file-input" accept="application/json" style="display:none;" />
        </div>

    </div>

    <!-- Loading Indicator -->
    <div class="loading-indicator hidden" id="loadingIndicator">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <!-- Toast Notification -->
    <div class="toast hidden" id="toast">
        <span id="toastMessage"></span>
    </div>

    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-button">√ó</span>
            <h2>Edit Profile</h2>
            <label for="avatarUpload">Upload Avatar:</label>
            <input type="file" id="avatarUpload" accept="image/*">
            <button class="btn btn-save-avatar" id="saveAvatarBtn">Save Avatar</button>
            <label for="exportDataBtn">Export Data:</label>
            <button class="btn btn-export" id="exportDataBtn">Export</button>
            <label for="importDataBtn">Import Data:</label>
            <input type="file" id="importDataBtn" accept="application/json">
            <button class="btn btn-import" id="importDataBtn">Import</button>
        </div>
    </div>

    <!-- Developer Information -->

<div class="developer-info">
    Powered by AI | Developed by MBA.ƒê·∫∑ng Duy Hi·ªÅn (email: hien.dang@bu.com.vn)
</div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Function to collect vocabulary data
            function collectVocabularyData() {
                return JSON.parse(localStorage.getItem('vocabulary_cards') || '[]');
            }

            // Function to collect study progress
            function collectStudyProgress() {
                return {
                    totalCards: parseInt(document.getElementById('total').textContent) || 0,
                    learnedCards: parseInt(document.getElementById('learned').textContent) || 0,
                    studyTime: localStorage.getItem('total_study_time') || '0 minutes',
                    lastStudySession: localStorage.getItem('last_study_session') || 'N/A'
                };
            }

            // Function to collect learning boxes progress
            function collectLearningBoxes() {
                const boxProgress = [];
                const boxElements = document.querySelectorAll('.box');
                
                boxElements.forEach(box => {
                    const boxNumber = box.getAttribute('data-box');
                    const boxCount = box.querySelector('.box-count').textContent;
                    
                    boxProgress.push({
                        boxNumber: boxNumber,
                        cardCount: parseInt(boxCount)
                    });
                });

                return boxProgress;
            }

            // Function to collect achievements
            function collectAchievements() {
                return [
                    { name: 'Vocabulary Novice', status: localStorage.getItem('vocabulary_novice_status') || 'Not Completed' },
                    { name: 'Language Explorer', status: localStorage.getItem('language_explorer_status') || 'Not Completed' }
                ];
            }

            // Function to restore vocabulary data
            function restoreVocabularyData(vocabularyCards) {
                localStorage.setItem('vocabulary_cards', JSON.stringify(vocabularyCards));
                // Update the UI if necessary
            }

            // Function to restore study progress
            function restoreStudyProgress(studyProgress) {
                const totalElement = document.getElementById('total');
                const learnedElement = document.getElementById('learned');
                
                if (totalElement) totalElement.textContent = studyProgress.totalCards;
                if (learnedElement) learnedElement.textContent = studyProgress.learnedCards;

                localStorage.setItem('total_study_time', studyProgress.studyTime);
                localStorage.setItem('last_study_session', studyProgress.lastStudySession);
            }

            // Function to restore learning boxes
            function restoreLearningBoxes(boxProgress) {
                const boxElements = document.querySelectorAll('.box');
                
                boxProgress.forEach(boxData => {
                    const boxElement = Array.from(boxElements).find(
                        el => el.getAttribute('data-box') === boxData.boxNumber.toString()
                    );
                    
                    if (boxElement) {
                        const countElement = boxElement.querySelector('.box-count');
                        if (countElement) countElement.textContent = boxData.cardCount;
                    }
                });
            }

            // Function to restore achievements
            function restoreAchievements(achievements) {
                achievements.forEach(achievement => {
                    localStorage.setItem(`${achievement.name.toLowerCase().replace(' ', '_')}_status`, achievement.status);
                });
            }

            // Function to update UI after import
            function updateUIAfterImport() {
                console.log('UI updated after data import');
                // Implement any necessary UI updates or refreshes
            }

            const exportDataBtn = document.getElementById('exportdataBtn');
            if (exportDataBtn) {
                exportDataBtn.addEventListener('click', function() {
                    try {
                        const learningData = {
                            timestamp: new Date().toISOString(),
                            vocabularyCards: collectVocabularyData(),
                            studyProgress: collectStudyProgress(),
                            learningBoxes: collectLearningBoxes(),
                            achievements: collectAchievements()
                        };

                        const exportData = JSON.stringify(learningData, null, 2);
                        const blob = new Blob([exportData], { type: 'application/json' });
                        const downloadLink = document.createElement('a');
                        downloadLink.href = URL.createObjectURL(blob);
                        const now = new Date();
                        const filename = `flashcard_learning_data_${now.toISOString().split('T')[0]}.json`;
                        downloadLink.download = filename;
                        document.body.appendChild(downloadLink);
                        downloadLink.click();
                        document.body.removeChild(downloadLink);
                        localStorage.setItem('flashcard_learning_backup', exportData);
                        localStorage.setItem('flashcard_learning_backup_timestamp', now.toISOString());
                        showToast('Learning data exported successfully!', 'success');
                    } catch (error) {
                        console.error('Export failed:', error);
                        showToast('Failed to export data. Please try again.', 'error');
                    }
                });
            } else {
                console.error('Export data button not found.');
            }

            const importButton = document.getElementById('importdataBtn');
            if (importButton) {
                importButton.addEventListener('click', function() {
                    console.log('Import button clicked');
                    const importFileInput = document.getElementById('import-file-input');
                    if (importFileInput) {
                        importFileInput.click();
                    } else {
                        console.error('Import file input not found.');
                    }
                });
            } else {
                console.error('Import button not found.');
            }

            const importFileInput = document.getElementById('import-file-input');
            if (importFileInput) {
                importFileInput.addEventListener('change', function(event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            try {
                                const importedData = JSON.parse(e.target.result);
                                if (!importedData.timestamp || !importedData.vocabularyCards) {
                                    throw new Error('Invalid data format');
                                }
                                if (importedData.vocabularyCards) {
                                    restoreVocabularyData(importedData.vocabularyCards);
                                }
                                if (importedData.studyProgress) {
                                    restoreStudyProgress(importedData.studyProgress);
                                }
                                if (importedData.learningBoxes) {
                                    restoreLearningBoxes(importedData.learningBoxes);
                                }
                                if (importedData.achievements) {
                                    restoreAchievements(importedData.achievements);
                                }
                                localStorage.setItem('flashcard_learning_data', JSON.stringify(importedData));
                                showToast('Learning data imported successfully!', 'success');
                                updateUIAfterImport();
                            } catch (error) {
                                console.error('Import failed:', error);
                                showToast('Failed to import data. Please check the file.', 'error');
                            }
                        };
                        reader.onerror = function(error) {
                            console.error('File reading error:', error);
                            showToast('Error reading file. Please try again.', 'error');
                        };
                        reader.readAsText(file);
                    }
                });
            } else {
                console.error('Import file input not found.');
            }
        });
    </script>

</body>
</html>